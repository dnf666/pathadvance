<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.pms.dao.Team.TeamWork">
    <!--团队表的信息-->
    <resultMap id="team" type="com.pms.model.Team.Team">
        <result column="team_name" property="team_name" jdbcType="VARCHAR" />
        <result column="create_by" property="create_by" jdbcType="VARCHAR" />
        <result column="create_time" property="create_time" jdbcType="MEDIUMTEXT" />
        <result column="del_flag" property="del_flag" jdbcType="TINYINT" />
        <result column="del_time" property="del_time" jdbcType="MEDIUMTEXT" />
        <result column="del_remarks" property="del_remarks" jdbcType="VARCHAR" />
    </resultMap>
    <!--新建团队-->
    <insert id="AddTeam">
        INSERT INTO team
        (team_name,create_by,create_time,del_flag,del_remarks) VALUES
        (#{team_name},#{create_by},#{create_time},#{del_flag},#{del_remarks})
    </insert>
    <!--更改团队信息-->
    <update id="UpdateTeam" parameterType="com.pms.model.Team.Team">
    UPDATE team
    <set>
        <if test="team_name != null ">
            team_name = #{team_name},
        </if>
    </set>
        WHERE team_name = #{team_name};
    </update>
    <!--  注销团队-->
    <update id="DelTeam" parameterType="com.pms.model.Team.Team">
        UPDATE team
        <set>
            <if test="del_flag!=0">
                del_flag=#{del_flag}
            </if>
            <if test="del_time!=null">
                del_time=#{del_time}
            </if>
            <if test="del_remarks!=null">
                del_remarks=#{del_remarks}
            </if>
        </set>
        WHERE team_name=#{team_name}
    </update>
<!--团队管理表的信息-->
    <resultMap id="team_master" type="com.pms.model.Team.TeamMaster">
        <result property="id" column="id" jdbcType="INT"/>
        <result column="team_name" property="team_name" jdbcType="VARCHAR" />
        <result column="user_name" property="user_name" jdbcType="VARCHAR" />
        <result column="to_role" property="to_role" jdbcType="VARCHAR"/>
        <result column="from_role" property="from_role" jdbcType="VARCHAR"/>
        <result column="modify_by" property="modify_by" jdbcType="VARCHAR"/>
        <result column="modify_at" property="modify_at" jdbcType="MEDIUMTEXT"/>
    </resultMap>
    <!--团队成员表的信息-->
    <resultMap id="teamMember" type="com.pms.model.Team.TeamMembers">
        <result column="user_name" property="user_name" jdbcType="VARCHAR" />
        <result column="team_name" property="team_name" jdbcType="VARCHAR" />
        <result column="team_role" property="team_role" jdbcType="VARCHAR" />
        <result column="team_privelige" property="team_privelige" jdbcType="TINYINT"/>
        <result column="join_time" property="join_time" jdbcType="MEDIUMTEXT" />
        <result column="join_by" property="join_by" jdbcType="VARCHAR" />
        <result column="del_flag" property="del_flag" jdbcType="TINYINT" />
        <result column="del_time" property="del_time" jdbcType="MEDIUMTEXT" />
        <result column="del_by" property="del_by" jdbcType="VARCHAR" />
        <result column="del_remarks" property="del_remarks" jdbcType="VARCHAR" />
    </resultMap>
    <!--团队成员的增加-->
    <insert id="AddMembers" >
        INSERT INTO team_member
        (user_name,team_name,team_role,join_time,join_by)VALUES
        (#{user_name},#{team_name},#{team_role},#{team_role},#{join_time},#{join_by})
    </insert>
    <!--删除团队成员-->
    <update id="DelMembers">
        UPDATE INTO team_member
        <set>
            <if test="del_flag!=0">
                del_flag=#{del_flag}
            </if>
            <if test="del_time!=null">
                del_time=#{del_time}
            </if>
            <if test="del_remarks!=null">
                del_remarks=#{del_remarks}
            </if>
        </set>
        WHERE team_name=#{team_name} AND user_name=#{user_name}
    </update>
    <!--团队成员的权限更改-->
    <update id="UpdateMemberPrivilege" parameterType="com.pms.model.Team.TeamMembers">
        UPDATE team_member
        <set>
            <if test="team_privelige!=0">
                team_privelige=#{team_privelige}
            </if>
        </set>
    </update>
<!--需要展示的团队信息-->
    <resultMap id="showInfoOfTeam" type="com.pms.dataModel.Team.TeamInfo">
        <result column="team_name" property="team_name" jdbcType="VARCHAR" />
        <result column="create_by" property="create_by" jdbcType="VARCHAR" />
        <result column="createTime" property="create_time" jdbcType="MEDIUMTEXT" />
        <result column="del_flag" property="del_flag" jdbcType="TINYINT" />
    </resultMap>
    <!--通过团队名称获取团队展示信息-->
    <select id="SelectTeamInfoByTeamName" resultMap="showInfoOfTeam">
        SELECT team_name,create_by,createTime
        FROM team
        WHERE team_name=#{team_name} AND del_flag=0
    </select>
<!--展示团队成员的信息-->
    <resultMap id="showTeamMembers" type="com.pms.dataModel.Team.TeamMembersInfo">
        <result column="team_name" property="name" jdbcType="VARCHAR" />
        <result column="user_name" property="user_name" jdbcType="VARCHAR" />
        <result column="team_role" property="team_role" jdbcType="VARCHAR" />
        <result column="join_time" property="join_time" jdbcType="MEDIUMTEXT" />
        <result column="del_flag" property="del_flag" jdbcType="TINYINT" />
    </resultMap>
    <!--通过团队名称获取团队成员展示的信息-->
    <select id="SelectMembersByTeamName" resultMap="showTeamMembers">
        SELECT user_name,team_role,join_time
        FROM team_member
        WHERE team_name=#{team_name} AND del_flag=0
    </select>
    <!--公告表的信息-->
    <resultMap id="Announcementinfo" type="com.pms.model.Team.TeamAnnouncement">
        <result column="title" property="title" jdbcType="VARCHAR"/>
        <result column="create_by" property="create_by" jdbcType="VARCHAR"/>
        <result column="create_time" property="create_time" jdbcType="MEDIUMTEXT"/>
        <result column="del_flag" property="del_flag" jdbcType="TINYINT"/>
        <result column="del_time" property="del_time" jdbcType="MEDIUMTEXT"/>
        <result column="context" property="context" jdbcType="VARCHAR"/>
        <result column="team_name" property="team_name" jdbcType="VARCHAR"/>
    </resultMap>
    <!--通过团队名称获取公告信息-->
    <select id="SelectAnnouncementByName" resultMap="Announcementinfo">
        SELECT title,create_by,create_time,team_name,context
        FROM notice
        WHERE team_name=#{team_name} AND del_flag=0
    </select>
    <!--创建公告-->
    <insert id="AddAnnouncements">
        INSERT INTO notice
        (title,create_by,create_time,context,team_name) VALUES
        (#{title},#{create_by},#{create_time},#{context},#{team_name})
    </insert>
    <!--更改公告-->
    <update id="ReEditAnnouncements" parameterType="com.pms.model.Team.TeamAnnouncement">
        UPDATE notice
        <set>
            <if test="title!=null">
                title=#{title}
            </if>
            <if test="create_by!=null">
                create_by=#{create_by}
            </if>
            <if test="create_time!=null">
                create_time=#{create_time}
            </if>
            <if test="context!=null">
                context=#{context}
            </if>
        </set>
        WHERE team_name=#{team_name} AND title=#{title} AND create_by=#{create_by} AND del_flag=0
    </update>
    <!--删除公告-->
    <update id="DelAnnouncements" parameterType="com.pms.model.Team.TeamAnnouncement">
        UPDATE notice
        <set>
            <if test="del_flag=0">
                del_flag=#{del_flag}
            </if>
            <if test="del_time=null">
                del_time=#{del_time}
            </if>
        </set>
        WHERE title=#{title} AND team_name=#{team_name} AND create_by=#{create_by}
    </update>
    <!--资料表-->
    <resultMap id="file" type="com.pms.model.Team.TeamData">
        <result column="file_name" property="file_name" jdbcType="VARCHAR"></result>
        <result column="url" property="url" jdbcType="VARCHAR"></result>
        <result column="class" property="file_class" jdbcType="VARCHAR"></result>
        <result column="size" property="size" jdbcType="DOUBLE"></result>
        <result column="create_by" property="create_by" jdbcType="VARCHAR"></result>
        <result column="del_flag" property="del_flag" jdbcType="TINYINT"></result>
        <result column="del_time" property="del_time" jdbcType="MEDIUMTEXT"></result>
        <result column="is_privater" property="is_privater" jdbcType="TINYINT"></result>
    </resultMap>
    <!--获取团队的资料-->
    <select id="SelectDataByClass" resultMap="file">
        SELECT file_name,url,class,size,create_by
        FROM file
        WHERE class=#{class}
    </select>
    <!--上传资料-->
    <insert id="AddData">
        INSERT INTO file
        (file_name,url,class,size,create_by,is_privater) VALUES
        (#{file_name,#{url},#{file_class},#{size},#{create_by},#{is_privater})
    </insert>
    <!--删除资料-->
    <update id="DelData" parameterType="com.pms.model.Team.TeamData">
        UPDATE file
        <set>
            <if test="del_flag!=0">
                del_flag=#{del_flag}
            </if>
            <if test="del_time!=null">
                del_time=#{del_time}
            </if>
        </set>
        WHERE url=#{url}
    </update>
<!--项目表-->
    <resultMap id="project" type="com.pms.model.Team.TeamProject">
        <result column="project_name" property="project_name" jdbcType="VARCHAR"></result>
        <result column="team_name" property="team_name" jdbcType="VARCHAR"></result>
        <result column="project_info" property="project_info" jdbcType="VARCHAR"></result>
        <result column="create_by" property="create_by" jdbcType="VARCHAR"></result>
        <result column="create_at" property="create_at" jdbcType="MEDIUMTEXT"></result>
        <result column="del_flag" property="del_flag" jdbcType="TINYINT"></result>
    </resultMap>
    <!--新建项目-->
    <insert id="AddProject" >
        INSERT INTO project
        (project_name,team_name,project_info,create_by,create_at) VALUES
        (#{project_name},#{team_name},#{peoject_info},#{create_by},#{create_at})
    </insert>
    <!--删除项目-->
    <update id="DelProject" parameterType="com.pms.model.Team.TeamProject">
        UPDATE project
        <set>
        <if test="del_flag!=0">
            del_flag=#{del_flag}
        </if>
        </set>
        WHERE team_name=#{team_name} AND project_name#{project_name}
    </update>
    <!--更改项目-->
    <update id="UpdateProject" parameterType="com.pms.model.Team.TeamProject">
        UPDATE project
        <set>
            <if test="project_name!=null">
                project_name=#{project_name}
            </if>
            <if test="project_info!=null">
                project_info=#{project_info}
            </if>
        </set>
        WHERE team_name=#{team_name} AND project_name#{project_name}
    </update>
    <resultMap id="projectInfo" type="com.pms.dataModel.Team.TeamProjectInfo">
        <result column="project_name" property="project_name" jdbcType="VARCHAR"></result>
        <result column="team_name" property="team_name" jdbcType="VARCHAR"></result>
        <result column="project_info" property="project_info" jdbcType="VARCHAR"></result>
        <result column="create_by" property="create_by" jdbcType="VARCHAR"></result>
        <result column="create_at" property="create_at" jdbcType="MEDIUMTEXT"></result>
        <result column="del_flag" property="del_flag" jdbcType="TINYINT"></result>
    </resultMap>
    <!--得到项目的信息-->
    <select id="SelectProjectsByTeamName" resultMap="projectInfo">
        SELECT project_name,project_info,creat_by,create_at
        FROM project
        WHERE team_name=#{team_name} AND del_flag=0
    </select>
    <!--项目成员表-->
    <resultMap id="project_members" type="com.pms.model.Team.TeamProjectMember">
        <result column="project_name" property="project_name" jdbcType="VARCHAR"></result>
        <result column="user_name" property="user_name" jdbcType="VARCHAR"></result>
        <result column="team_role" property="team_role" jdbcType="VARCHAR"></result>
        <result column="join_time" property="join_time" jdbcType="MEDIUMTEXT"></result>
        <result column="join_by" property="join_by" jdbcType="VARCHAR"></result>
        <result column="del_flag" property="del_flag" jdbcType="TINYINT"></result>
        <result column="del_time" property="del_time" jdbcType="MEDIUMTEXT"></result>
        <result column="del_by" property="del_by" jdbcType="VARCHAR"></result>
        <result column="del_remarks" property="del_remarks" jdbcType="VARCHAR"></result>
    </resultMap>
    <!--增加成员-->
    <insert id="AddProjectMembers">
        INSERT INTO project_member
        (project_name,user_name,team_role,join_time,join_by)VALUES
        (#{project_name},#{user_name},#{team_role},#{join_time},#{join_by})
    </insert>
    <!--删除成员-->
    <update id="DelProjectMembers" parameterType="com.pms.model.Team.TeamProjectMember">
        UPDATE project_member
        <set>
            <if test="del_flag!=0">
                del_flag=#{del_flag}
            </if>
            <if test="del_time!=null">
                del_time=#{del_time}
            </if>
            <if test="del_by!=null">
                del_by=#{del_by}
            </if>
            <if test="del_remarks!=null">
                del_remarks=#{del_remarks}
            </if>
        </set>
        WHERE project_name=#{project_name} AND user_name=#{user_name}
    </update>
    <!--项目成员的信息-->
    <resultMap id="project_member_info" type="com.pms.dataModel.Team.TeamProjectMembers">
        <result column="project_name" property="project_name" jdbcType="VARCHAR"></result>
        <result column="user_name" property="user_name" jdbcType="VARCHAR"></result>
        <result column="team_role" property="team_role" jdbcType="VARCHAR"></result>
        <result column="join_time" property="join_time" jdbcType="MEDIUMTEXT"></result>
        <result column="join_by" property="join_by" jdbcType="VARCHAR"></result>
        <result column="del_flag" property="del_flag" jdbcType="TINYINT"></result>
    </resultMap>
    <!--通过项目名称获取成员信息-->
    <select id="SelectProjectMembersByProjectName" resultMap="project_member_info">
        SELECT project_name,user_name,join_by,join_time,team_role
        FROM project_member
        WHERE project_name=#{project_name} AND del_flag=0
    </select>
</mapper>